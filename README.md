# ESP32-S3 High-Fidelity Digital Audio Player

> åŸºæ–¼ I2S èˆ‡é›»æºéš”é›¢æ¶æ§‹çš„ä¾¿æ”œå¼é«˜ä¿çœŸéŸ³æ¨‚æ’­æ”¾å™¨

![Project Status](https://img.shields.io/badge/Status-Phase%201%20Prototype-yellow)
![License](https://img.shields.io/badge/License-MIT-blue)

## ğŸ“‹ å°ˆæ¡ˆæ‘˜è¦ (Executive Summary)

æœ¬å°ˆæ¡ˆæ—¨åœ¨é–‹ç™¼ä¸€æ¬¾åŸºæ–¼ **ESP32-S3** å¾®æ§åˆ¶å™¨çš„ä¾¿æ”œå¼é«˜ä¿çœŸ (Hi-Fi) éŸ³æ¨‚æ’­æ”¾å™¨ã€‚ä¸åŒæ–¼å¸‚é¢ä¸Šçš„å»‰åƒ¹ MP3 æ¨¡çµ„ï¼Œæœ¬å°ˆæ¡ˆæ ¸å¿ƒåœ¨æ–¼ã€Œ**é›»æºç´”æ·¨åº¦**ã€èˆ‡ã€Œ**é«˜è§£æéŸ³è¨Šæ¶æ§‹**ã€ã€‚

### æ ¸å¿ƒç‰¹è‰²

- ğŸµ **32-bit DAC è§£ç¢¼**ï¼šæ¡ç”¨ TI PCM5102Aï¼Œæä¾› 112dB SNR
- âš¡ **é›»æºéš”é›¢è¨­è¨ˆ**ï¼šæ•¸ä½/é¡æ¯”é›»æºå®Œå…¨åˆ†é›¢ï¼Œå¾¹åº•æ¶ˆé™¤ç„¡ç·šå¹²æ“¾èˆ‡åº•å™ª
- ğŸ”‹ **æ™ºèƒ½é›»æºç®¡ç†**ï¼šMCP73871 è·¯å¾‘ç®¡ç†ï¼Œæ”¯æ´é‚Šå……é‚Šç”¨ (Load Sharing)
- ğŸ§ **é«˜é©…å‹•åŠ›**ï¼šç›´æ¨é«˜éˆæ•åº¦è€³æ©Ÿ (å¦‚ Bose QC45)
- ğŸ¨ **é¡ iPod é«”é©—**ï¼šæµæš¢çš„ä½¿ç”¨è€…ä»‹é¢èˆ‡æ“ä½œé«”é©— (Phase 3)

---

## ğŸ”§ ç¡¬é«”æ¶æ§‹ (Hardware Architecture)

### ç³»çµ±æ–¹å¡Šåœ–

```
USB-C â”€â”€â–º MCP73871 â”€â”€â”¬â”€â”€â–º RT9013 (3.3V_DIG) â”€â”€â–º ESP32-S3 + SD Card
         (å……é›»ç®¡ç†)   â”‚
                     â””â”€â”€â–º LP5907 (3.3V_AUD) â”€â”€â–º PCM5102A â”€â”€â–º 3.5mm Out

         Li-Po Battery (1200~2000mAh)
```

### 1ï¸âƒ£ æ ¸å¿ƒè™•ç†å–®å…ƒ (Core)

| å…ƒä»¶    | å‹è™Ÿ                  | è¦æ ¼                      | é¸ç”¨ç†ç”±                                  |
| ------- | --------------------- | ------------------------- | ----------------------------------------- |
| **MCU** | ESP32-S3 (N16R8/N8R2) | é›™æ ¸å¿ƒ 240MHz, 16MB Flash | åŸç”Ÿ USB CDCã€è±å¯Œ GPIOã€å¼·å¤§éŸ³è¨Šè™•ç†èƒ½åŠ› |

### 2ï¸âƒ£ éŸ³è¨Šè§£ç¢¼ç³»çµ± (Audio Subsystem)

| å…ƒä»¶     | å‹è™Ÿ        | è¦æ ¼              | ç‰¹è‰²                           |
| -------- | ----------- | ----------------- | ------------------------------ |
| **DAC**  | TI PCM5102A | 32-bit, 112dB SNR | DirectPathâ„¢ æŠ€è¡“ï¼Œç„¡éš”ç›´é›»å®¹   |
| **ä»‹é¢** | I2S         | BCLK, LRCK, DIN   | Slave Mode (å…§éƒ¨ PLL ç”Ÿæˆ SCK) |
| **è¼¸å‡º** | Line-Out    | 2.1Vrms           | ç›´æ¨ä¸»å‹•å¼é™å™ªè€³æ©Ÿ             |

### 3ï¸âƒ£ é›»æºç®¡ç†ç³»çµ± (Power Management) â­ æœ¬å°ˆæ¡ˆç²¾é«“

#### è¼¸å…¥èˆ‡å……é›»

- **è¼¸å…¥ç«¯**ï¼šUSB-C (Host Mode, 5.1kÎ© ä¸‹æ‹‰é›»é˜»)
- **å……é›»ç®¡ç†**ï¼šMicrochip MCP73871
  - âœ… Load Sharing (é‚Šå……é‚Šç”¨)
  - âœ… å„ªå…ˆç”± USB ä¾›é›»çµ¦ç³»çµ±
  - âœ… å……é›»é›»æµï¼š500mA (PROG1 = 2kÎ©)

#### é›™ LDO éš”é›¢ç­–ç•¥ (Dual LDO Strategy)

| é›»æºè»Œ       | LDO å‹è™Ÿ        | ä¾›é›»å°è±¡          | ç›®çš„                          |
| ------------ | --------------- | ----------------- | ----------------------------- |
| **3.3V_DIG** | RT9013 / XC6206 | ESP32-S3, SD Card | æ•¸ä½é›»è·¯ä¾›é›»                  |
| **3.3V_AUD** | TI LP5907       | PCM5102A          | è¶…ä½é›œè¨Šï¼Œéš”çµ• Wi-Fi/CPU é›œè¨Š |

#### å„²èƒ½

- **é›»æ± **ï¼š1200mAh ~ 2000mAh é‹°èšåˆç‰©é›»æ±  (103450 è¦æ ¼)
- **çºŒèˆªç›®æ¨™**ï¼š> 6 å°æ™‚é€£çºŒæ’­æ”¾

### 4ï¸âƒ£ å„²å­˜èˆ‡ä»‹é¢ (Storage & UI)

| å…ƒä»¶     | å‹è™Ÿ            | ä»‹é¢        | éšæ®µ       |
| -------- | --------------- | ----------- | ---------- |
| **å„²å­˜** | MicroSD Card    | SPI         | Phase 1 âœ… |
| **é¡¯ç¤º** | 1.69" IPS LCD   | ST7789, SPI | Phase 3 ğŸ”œ |
| **è¼¸å…¥** | EC11 æ—‹è½‰ç·¨ç¢¼å™¨ | GPIO        | Phase 3 ğŸ”œ |

---

## ğŸ’» è»Ÿé«”æ¶æ§‹ (Software Architecture)

### é–‹ç™¼ç’°å¢ƒ

- **IDE**ï¼šVisual Studio Code + PlatformIO
- **æ¡†æ¶**ï¼šArduino Framework for ESP32

### æ ¸å¿ƒå‡½å¼åº«

| åŠŸèƒ½         | å‡½å¼åº«         | ç”¨é€”                             |
| ------------ | -------------- | -------------------------------- |
| **éŸ³è¨Šè™•ç†** | ESP32-audioI2S | MP3, WAV, FLAC, AAC è§£ç¢¼         |
| **åœ–å½¢ä»‹é¢** | LvGL           | æ»¾å‹•æ…£æ€§é¸å–®ã€å°ˆè¼¯å°é¢ã€æµæš¢å‹•ç•« |
| **æª”æ¡ˆç³»çµ±** | SD / SPI       | MicroSD å¡è®€å–                   |

### é›»æºç®¡ç†é‚è¼¯

```cpp
// SD å¡æ’­æ”¾æ¨¡å¼
WiFi.mode(WIFI_OFF);           // å¼·åˆ¶é—œé–‰ WiFi
setCpuFrequencyMhz(160);       // é™é »è‡³ 160MHz
// ç›®æ¨™ï¼šå»¶é•·çºŒèˆªæ™‚é–“
```

---

## ğŸ—“ï¸ é–‹ç™¼è·¯ç·šåœ– (Roadmap)

### Phase 1: åŸå‹é©—è­‰ (Current Stage) ğŸ”„

- [x] ç¢ºèª DAC é¸å‹ (PCM5102A)
- [x] ç¢ºèªé›»æºç®¡ç†æ–¹æ¡ˆ (MCP73871 + é›™ LDO)
- [ ] **éºµåŒ…æ¿æ­å»º**ï¼šESP32 + SD + PCM5102
- [ ] **éŸ³è¨Šæ¸¬è©¦**ï¼šæˆåŠŸæ’­æ”¾éŸ³æ¨‚æª”æ¡ˆ
- [ ] **è½æ„Ÿæ¸¬è©¦**ï¼šå¯¦æ¸¬ Bose QC45 åº•å™ªè¡¨ç¾

### Phase 2: é›»æºå„ªåŒ–èˆ‡å¾®å‹åŒ– âš¡

- [ ] ç„Šæ¥ MCP73871 èˆ‡é›™ LDO é›»è·¯
- [ ] å¯¦æ¸¬é›»æ± çºŒèˆªåŠ› (ç›®æ¨™ > 6 å°æ™‚)
- [ ] è§£æ±ºæ¥åœ°è¿´è·¯ (Ground Loop) å•é¡Œ
- [ ] å„ªåŒ– PCB/æ´æ´æ¿ä½ˆç·š

### Phase 3: äº’å‹•é«”é©—å‡ç´š (The "iPod" Feel) ğŸ¨

- [ ] å°å…¥ ST7789 IPS è¢å¹•
- [ ] å°å…¥ EC11 æ—‹è½‰ç·¨ç¢¼å™¨
- [ ] ç§»æ¤ LvGL åœ–å½¢ä»‹é¢
- [ ] è£½ä½œå°ˆè¼¯å°é¢é¡¯ç¤ºèˆ‡æ»¾å‹•é¸å–® UI

---

## ğŸ’° é ç®—ä¼°è¨ˆ (Budget)

| é …ç›®     | å‹è™Ÿ                   | é ä¼°åƒ¹æ ¼ (TWD) |
| -------- | ---------------------- | -------------- |
| MCU      | ESP32-S3 DevKit        | $250           |
| DAC      | GY-PCM5102             | $180           |
| é›»æºç®¡ç† | MCP73871 æ¨¡çµ„          | $150           |
| LDOs     | LP5907 + RT9013        | $50            |
| é›»æ±      | 103450 Li-Po (2000mAh) | $250           |
| é¡¯ç¤ºå™¨   | 1.69" IPS LCD          | $150           |
| æ§åˆ¶å™¨   | EC11 + æŒ‰éˆ•            | $50            |
| é›œé …     | Type-C, PCB, ç·šæ      | $100           |
| **ç¸½è¨ˆ** |                        | **ç´„ $1,180**  |

---

## ğŸ“ é›»è·¯è¨­è¨ˆé‡é»

### æ¥åœ°ç­–ç•¥ (Grounding)

```
æ•¸ä½åœ° (DGND) â”€â”€â”
                â”œâ”€â”€â–º å–®é»æ¥åœ° (Star Ground)
é¡æ¯”åœ° (AGND) â”€â”€â”˜
```

### PCM5102A é€£æ¥

```
ESP32-S3          PCM5102A
GPIO 26 â”€â”€â”€â”€â”€â”€â”€â”€â–º BCK  (Bit Clock)
GPIO 25 â”€â”€â”€â”€â”€â”€â”€â”€â–º LRCK (Left/Right Clock)
GPIO 22 â”€â”€â”€â”€â”€â”€â”€â”€â–º DIN  (Data In)
3.3V_AUD â”€â”€â”€â”€â”€â”€â”€â–º VCC
AGND â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º GND
```

---

## ğŸš€ å¿«é€Ÿé–‹å§‹ (Quick Start)

### ç’°å¢ƒéœ€æ±‚

- Visual Studio Code
- PlatformIO IDE Extension
- ESP32-S3 é–‹ç™¼æ¿
- USB-C å‚³è¼¸ç·š

### å®‰è£æ­¥é©Ÿ

```bash
# 1. Clone å°ˆæ¡ˆ
git clone https://github.com/s990093/ESP32-S3-HiFi-DAP.git
cd ESP32-S3-HiFi-DAP

# 2. ä½¿ç”¨ PlatformIO é–‹å•Ÿå°ˆæ¡ˆ
code .

# 3. ç·¨è­¯ä¸¦ä¸Šå‚³
pio run --target upload
```

---

## ğŸ“š åƒè€ƒè³‡æ–™ (References)

### æŠ€è¡“æ–‡ä»¶

- [PCM5102A Datasheet](https://www.ti.com/product/PCM5102A)
- [MCP73871 Datasheet](https://www.microchip.com/en-us/product/MCP73871)
- [ESP32-S3 Technical Reference](https://www.espressif.com/sites/default/files/documentation/esp32-s3_technical_reference_manual_en.pdf)

### é–‹æºå°ˆæ¡ˆåƒè€ƒ

- [ESP32-audioI2S](https://github.com/schreibfaul1/ESP32-audioI2S)
- [LvGL](https://lvgl.io/)

---

## ğŸ“ æˆæ¬Š (License)

æœ¬å°ˆæ¡ˆæ¡ç”¨ MIT License æˆæ¬Š - è©³è¦‹ [LICENSE](LICENSE) æª”æ¡ˆ

---

## ğŸ‘¤ ä½œè€… (Author)

**hungwei** (s990093)

- GitHub: [@s990093](https://github.com/s990093)

---

## ğŸ™ è‡´è¬ (Acknowledgments)

æ„Ÿè¬æ‰€æœ‰é–‹æºç¤¾ç¾¤çš„è²¢ç»è€…ï¼Œç‰¹åˆ¥æ˜¯ï¼š

- ESP32-audioI2S å°ˆæ¡ˆ
- LvGL åœ˜éšŠ
- PlatformIO é–‹ç™¼åœ˜éšŠ

---

<div align="center">

**â­ å¦‚æœé€™å€‹å°ˆæ¡ˆå°ä½ æœ‰å¹«åŠ©ï¼Œè«‹çµ¦å€‹ Starï¼**

Made with â¤ï¸ and ğŸµ

</div>
